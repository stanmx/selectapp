<%= debug @cities %>

<h1>Listing stores</h1>
<script type="text/javascript">
  $(document).ready(function(){
 $('#_stores_state_id').chained('#_stores_id');
});
</script>

<div id="search">
  <%= form_for stores_path, :method => :get do |f| %>
    <fieldset>
      <label>State</label>
      <%= f.select :id, @states.map {|comp| [comp.name, comp.id]}, {:include_blank => true} %>

      <label>City</label>
      <%= f.select :state_id, @cities.map {|cty| [cty.name, cty.id, :class =>cty.state_id]}, {:include_blank => true} %>
      <%= submit_tag "Search", :name => nil %>
    </fieldset>
  <% end %>
</div><br />

<table>
  <tr>
    <th>State</th>
    <th>City</th>
    <th>Name</th>
    <th>Address</th>
    <th></th>
    <th></th>
    <th></th>
  </tr>

<% @stores.each do |store| %>
  <tr>
    <td><%= store.city.state.name %></td>
    <td><%= store.city.name %></td>
    <td><%= store.name %></td>
    <td><%= store.address %></td>
    <td><%= link_to 'Show', store %></td>
    <td><%= link_to 'Edit', edit_store_path(store) %></td>
    <td><%= link_to 'Destroy', store, :method => :delete, :data => { :confirm => 'Are you sure?' } %></td>
  </tr>
<% end %>
</table>

<br />

<%= link_to 'New Store', new_store_path %>
